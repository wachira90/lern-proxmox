# **Step-by-Step Walkthrough ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î** 

‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ **Proxmox VE Cluster + HA (High Availability)** ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Production ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

---

# üß≠ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Proxmox VE Cluster + HA (Step-by-Step)

## üß± ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Infrastructure Requirements)

* ‚úÖ Proxmox VE ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏ô **‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2-3 Node**
* ‚úÖ Network ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ Cluster, Storage, ‡πÅ‡∏•‡∏∞ Public)
* ‚úÖ Shared Storage ‡πÄ‡∏ä‡πà‡∏ô NFS, iSCSI, Ceph, ZFS over iSCSI (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Live Migration ‡πÅ‡∏•‡∏∞ HA)
* ‚úÖ Time sync (‡πÉ‡∏ä‡πâ `chrony` ‡∏´‡∏£‡∏∑‡∏≠ `ntp`)

---

## üîß STEP 1: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Node ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á

### 1.1 ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ hostname ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô

```bash
hostnamectl set-hostname pve1     # ‡∏ó‡∏≥‡∏ö‡∏ô node ‡πÅ‡∏£‡∏Å
hostnamectl set-hostname pve2     # ‡∏ó‡∏≥‡∏ö‡∏ô node ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á
```

### 1.2 ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `/etc/hosts`

‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ node ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ô:

```bash
192.168.1.101 pve1
192.168.1.102 pve2
```

> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ IP Address ‡∏Ç‡∏≠‡∏á interface ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Cluster (‡πÄ‡∏ä‡πà‡∏ô LAN ‡∏´‡∏£‡∏∑‡∏≠ dedicated interface)

---

## üîß STEP 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Cluster ‡∏ö‡∏ô Node ‡πÅ‡∏£‡∏Å (pve1)

```bash
pvecm create my-cluster
```

* `my-cluster` ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠ Cluster ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á
* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ `corosync` ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:

```bash
pvecm status
```

---

## üîß STEP 3: Join Node ‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô Cluster

### 3.1 ‡∏ö‡∏ô node ‡πÉ‡∏´‡∏°‡πà (pve2):

```bash
pvecm add 192.168.1.101
```

> ‡πÉ‡∏ä‡πâ IP ‡∏´‡∏£‡∏∑‡∏≠ hostname ‡∏Ç‡∏≠‡∏á node ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á Cluster

### 3.2 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å node ‡πÅ‡∏£‡∏Å‡∏ß‡πà‡∏≤ node ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß

```bash
pvecm nodes
```

> ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô Node 1 ‡πÅ‡∏•‡∏∞ Node 2 ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Cluster

---

## üóÑÔ∏è STEP 4: ‡πÄ‡∏û‡∏¥‡πà‡∏° Shared Storage (NFS, iSCSI, Ceph)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° NFS (‡∏ú‡πà‡∏≤‡∏ô Web UI):**

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Datacenter` ‚Üí `Storage`
2. Click ‚ÄúAdd‚Äù ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `NFS`
3. ‡πÉ‡∏™‡πà:

   * ID: ‡∏ä‡∏∑‡πà‡∏≠ storage (‡πÄ‡∏ä‡πà‡∏ô `shared-nfs`)
   * Server: IP ‡∏Ç‡∏≠‡∏á NFS Server
   * Export: Path ‡∏ó‡∏µ‡πà export ‡πÄ‡∏ä‡πà‡∏ô `/mnt/pve/nfs`
   * Content: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö VM, ISO, Backup ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
4. Click ‚ÄúAdd‚Äù

---

## üì¶ STEP 5: ‡∏™‡∏£‡πâ‡∏≤‡∏á VM ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Shared Storage

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Create VM`
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (VM ID, Name)
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ISO ‡πÅ‡∏•‡∏∞ Disk ‚Üí ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ Disk ‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Shared Storage (`shared-nfs` ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô ‡πÜ)
4. Finish

> **‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô shared storage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡πâ‡∏≤‡∏¢ VM ‡πÑ‡∏î‡πâ!**

---

## üîÅ STEP 6: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô HA (High Availability)

### 6.1 ‡πÄ‡∏õ‡∏¥‡∏î ‚ÄúHA Manager‚Äù ‡∏ö‡∏ô‡∏ó‡∏∏‡∏Å Node

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ HA Manager ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

```bash
systemctl status pve-ha-lrm
```

### 6.2 ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô HA ‡∏ú‡πà‡∏≤‡∏ô Web UI

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Datacenter` ‚Üí `HA`
2. Click ‚ÄúAdd‚Äù
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å VM ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:

   * **Group**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏° Node ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô VM ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
   * **Recovery Policy**:

     * `restart` ‚Äì ‡∏´‡∏≤‡∏Å VM crash ‡∏à‡∏∞ restart ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°
     * `migrate` ‚Äì ‡∏´‡∏≤‡∏Å Node ‡∏ï‡∏≤‡∏¢ VM ‡∏à‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ node ‡∏≠‡∏∑‡πà‡∏ô
4. Click ‚ÄúAdd‚Äù

---

## üß™ STEP 7: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö HA

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á VM ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô shared storage ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î HA
2. ‡∏õ‡∏¥‡∏î node ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô VM ‡∏≠‡∏¢‡∏π‡πà (shutdown ‡∏´‡∏£‡∏∑‡∏≠ unplug network)
3. ‡∏î‡∏π‡∏ß‡πà‡∏≤ VM ‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢ (migrate) ‡πÑ‡∏õ Node ‡∏≠‡∏∑‡πà‡∏ô‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

---

## üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á CLI ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

* ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ cluster:

  ```bash
  pvecm status
  ```
* ‡∏î‡∏π Node ‡πÉ‡∏ô cluster:

  ```bash
  pvecm nodes
  ```
* ‡∏î‡∏π VM HA status:

  ```bash
  ha-manager status
  ```

---

## üõ†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

* ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ local disk ‡πÉ‡∏ô VM ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ HA
* ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏° sync ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å node (`chrony` ‡∏´‡∏£‡∏∑‡∏≠ `ntp`)
* ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ 3 Node ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠ quorum ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ (2 node ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ quorum ‡∏´‡∏≤‡∏Å node ‡πÉ‡∏î node ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ï‡∏≤‡∏¢)
* ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Ceph ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ disk redundancy ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô 3 OSD ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)

---

## üéØ ‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ

Proxmox VE ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Cluster ‡πÅ‡∏•‡∏∞ HA ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á config `pacemaker` ‡πÄ‡∏≠‡∏á:

| ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ                | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢         |
| ------------------------- | ---------------- |
| Cluster Communication     | ‚úÖ ‡∏á‡πà‡∏≤‡∏¢           |
| HA Manager                | ‚úÖ Built-in       |
| Live Migration            | ‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß |
| Storage ‡πÅ‡∏ö‡∏ö Cluster-aware | ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏ô‡∏¥‡∏î |
| UI ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HA              | ‚úÖ Web UI ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô |

---

=== 

‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ **Sample Config ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:

1. ‚úÖ **HA Group Script ‡∏ö‡∏ô Proxmox VE**
2. ‚úÖ **Ceph Integration (‡∏û‡∏£‡πâ‡∏≠‡∏° config storage pool)**
3. ‚úÖ **Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Failover ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå HA Event**

---

## üß© 1. **HA Group Script (Proxmox VE)**

**HA Group** ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ VM ‡πÉ‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Node ‡πÑ‡∏´‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Priority ‡∏î‡πâ‡∏ß‡∏¢

### üìå ‡∏™‡∏£‡πâ‡∏≤‡∏á HA Group (‡∏ú‡πà‡∏≤‡∏ô CLI)

```bash
ha-manager groupadd hagrp1 --nodes pve1,pve2 --nofailback 1
```

* `hagrp1`: ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°
* `--nodes`: ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ node ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô group
* `--nofailback 1`: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ node ‡∏ü‡∏∑‡πâ‡∏ô VM ‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ node ‡πÄ‡∏î‡∏¥‡∏° (optional)

### üìå ‡πÄ‡∏û‡∏¥‡πà‡∏° VM ‡πÄ‡∏Ç‡πâ‡∏≤ HA + ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Group

```bash
ha-manager add vm:100 --group hagrp1 --state started
```

* `vm:100`: ID ‡∏Ç‡∏≠‡∏á VM
* `--group hagrp1`: ‡πÉ‡∏´‡πâ VM ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° HA group ‡∏ô‡∏µ‡πâ
* `--state started`: ‡∏ö‡∏π‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô Cluster

### üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:

```bash
ha-manager config
ha-manager status
```

---

## ü™µ 2. **Ceph Integration (Storage ‡πÅ‡∏ö‡∏ö Hyper-Converged)**

Proxmox VE ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **Ceph** ‡πÅ‡∏ö‡∏ö Native ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Web UI ‡∏´‡∏£‡∏∑‡∏≠ CLI ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å

### üìå ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÜ:

#### A. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Ceph ‡∏ö‡∏ô Node ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```bash
pveceph install
```

#### B. ‡∏™‡∏£‡πâ‡∏≤‡∏á Cluster Ceph (node ‡πÅ‡∏£‡∏Å)

```bash
pveceph init --network 10.10.10.0/24
```

#### C. ‡∏™‡∏£‡πâ‡∏≤‡∏á Monitor + Manager

```bash
pveceph mon create
pveceph mgr create
```

#### D. ‡∏™‡∏£‡πâ‡∏≤‡∏á OSD (‡∏ö‡∏ô disk ‡πÄ‡∏õ‡∏•‡πà‡∏≤)

```bash
pveceph osd create /dev/sdb
```

(‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏ö‡∏ô‡∏ó‡∏∏‡∏Å node ‡∏ó‡∏µ‡πà‡∏°‡∏µ disk ‡πÉ‡∏´‡πâ Ceph)

#### E. ‡∏™‡∏£‡πâ‡∏≤‡∏á Ceph Pool

```bash
pveceph pool create cephpool --size 3 --min_size 2
```

#### F. ‡πÄ‡∏û‡∏¥‡πà‡∏° Ceph Pool ‡πÄ‡∏õ‡πá‡∏ô Storage

```bash
pvesh create /storage \
    -storage cephstore \
    -type rbd \
    -monhost 10.10.10.1 \
    -pool cephpool \
    -content images,rootdir \
    -krbd 1
```

> ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏ú‡πà‡∏≤‡∏ô UI: `Datacenter > Storage > Add > RBD (Ceph)`

---

## üìä 3. **Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Failover ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå HA Events**

Proxmox ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å HA events ‡πÉ‡∏ô log ‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î:

### üìå ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ HA ‡πÅ‡∏ö‡∏ö real-time:

```bash
ha-manager status
```

### üìå Log ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á HA:

```bash
journalctl -u pve-ha-lrm
journalctl -u pve-ha-crm
```

* `pve-ha-lrm`: Local Resource Manager ‚Äì ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° VM ‡∏ö‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ node
* `pve-ha-crm`: Cluster Resource Manager ‚Äì ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à failover

### üìå ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Log Failover:

```text
Jul 24 14:03:21 pve2 pve-ha-lrm[1234]: vm:100: state changed from started to error
Jul 24 14:03:22 pve1 pve-ha-crm[4567]: info: requesting vm:100 to recover on node pve1
Jul 24 14:03:25 pve1 pve-ha-lrm[7890]: vm:100 started successfully
```

### üìå ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå:

1. VM ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô state ‚Üí error (‡∏ö‡∏ô node ‡πÄ‡∏î‡∏¥‡∏°)
2. CRM ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å failover ‡πÑ‡∏õ node ‡∏≠‡∏∑‡πà‡∏ô
3. LRM ‡∏ö‡∏ô node ‡πÉ‡∏´‡∏°‡πà start VM ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### üì¶ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå HA ‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß:

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô script ‡πÄ‡∏ä‡πá‡∏Ñ failover events ‡∏î‡πâ‡∏ß‡∏¢ `grep`:

```bash
journalctl -u pve-ha-lrm | grep 'state changed from'
```

‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á log ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö ELK / Loki / Grafana ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö visualize

---

## üß† Tip ‡πÄ‡∏™‡∏£‡∏¥‡∏°

| ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢              | ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥                                                                     |
| --------------------- | --------------------------------------------------------------------------- |
| **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Failover** | ‡πÉ‡∏ä‡πâ `shutdown -h now` ‡∏´‡∏£‡∏∑‡∏≠ `iptables -A INPUT -j DROP` ‡∏ï‡∏±‡∏î network ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß |
| **Ceph Redundancy**   | ‡πÉ‡∏ä‡πâ `size=3`, `min_size=2` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ redundancy 1 node                          |
| **HA ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô?**      | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ VM ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô **shared storage** ‡∏´‡∏£‡∏∑‡∏≠ Ceph ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô                  |

---

‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:

* ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á `ha-manager config` export
* ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Live Migration ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ CPU/Memory ‡∏™‡∏π‡∏á
* Monitoring integration ‡∏Å‡∏±‡∏ö Zabbix, Prometheus

‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡∏ö ‚úÖ

