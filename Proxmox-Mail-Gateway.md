**Proxmox Mail Gateway** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö **Email Security Gateway** ‡πÅ‡∏ö‡∏ö‡πÇ‡∏≠‡πÄ‡∏û‡πà‡∏ô‡∏ã‡∏≠‡∏£‡πå‡∏™ ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏≠‡∏≠‡∏Å** ‡∏à‡∏≤‡∏Å **‡∏™‡πÅ‡∏õ‡∏° (Spam), ‡∏°‡∏±‡∏•‡πÅ‡∏ß‡∏£‡πå (Malware), ‡∏ü‡∏¥‡∏ä‡∏ä‡∏¥‡πà‡∏á (Phishing)** ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏Ñ‡∏∏‡∏Å‡∏Ñ‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•

---

### üîß ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Proxmox Mail Gateway:

1. **Antispam ‡πÅ‡∏•‡∏∞ Antivirus:**

   * ‡πÉ‡∏ä‡πâ **SpamAssassin**, **ClamAV**, **Razor**, **Pyzor**, ‡πÅ‡∏•‡∏∞ **DKIM/DMARC/SPF** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡πÅ‡∏õ‡∏°‡πÅ‡∏•‡∏∞‡πÑ‡∏ß‡∏£‡∏±‡∏™
   * ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Bayesian filtering) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡πÅ‡∏õ‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥

2. **‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ (Policy-based Filtering):**

   * ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏é (rules) ‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á, ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö, ‡∏Ç‡∏ô‡∏≤‡∏î, ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ ‡∏Ø‡∏•‡∏Ø ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô

3. **‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏±‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (Cluster):**

   * ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏´‡∏ô‡∏î (High Availability / Load Balancing)

4. **Web Interface ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢:**

   * UI ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢, ‡∏î‡∏π logs, ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö

5. **Email Quarantine ‡πÅ‡∏•‡∏∞ User Quarantine Web Interface:**

   * ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏±‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ

6. **Relay Mode:**

   * ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô mail proxy: ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‚Üí ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ mail server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô Microsoft Exchange, Zimbra, Postfix ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô)

---

### üõ°Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ:

* ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ **‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á Mail Server ‡∏´‡∏•‡∏±‡∏Å** ‡∏à‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
* ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏£‡∏≠‡∏á spam ‡πÅ‡∏•‡∏∞ virus ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á user
* ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô email security appliance ‡πÄ‡∏ä‡∏¥‡∏á‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå ‡πÄ‡∏ä‡πà‡∏ô Barracuda, FortiMail, ‡∏´‡∏£‡∏∑‡∏≠ Proofpoint

---

### üîÑ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:

```plaintext
[Internet] ‚Üí [Proxmox Mail Gateway] ‚Üí [Mail Server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô Exchange/Postfix]
```

===

‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á Proxmox Mail Gateway (PMG)** ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á OS, ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Mail Relay, ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô

---

## ‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Proxmox Mail Gateway

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:

> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î **ISO ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£**:
> üîó [https://www.proxmox.com/en/downloads](https://www.proxmox.com/en/downloads)

### 1.1 ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å ISO

* ‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ô‡πÑ‡∏ü‡∏•‡πå ISO ‡∏•‡∏á USB
* Boot ‡∏à‡∏≤‡∏Å USB ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Debian-based Linux ‡∏õ‡∏Å‡∏ï‡∏¥
* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: hostname, IP, timezone

---

## ‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Web UI

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à:

* ‡πÄ‡∏õ‡∏¥‡∏î browser ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Web UI ‡∏ú‡πà‡∏≤‡∏ô

  ```
  https://<your-pmg-ip>:8006
  ```
* ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ root + ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

---

## ‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Mail Relay ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô

### 3.1 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Mail Domain ‡πÅ‡∏•‡∏∞ Mail Relay

* ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Configuration > Mail Proxy > Relay Domains**

  * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ä‡πà‡∏ô `example.com`)
* ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Configuration > Mail Proxy > Transports**

  * ‡πÄ‡∏û‡∏¥‡πà‡∏° Mail Server ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£
  * ‡πÄ‡∏ä‡πà‡∏ô:

    ```
    Domain: example.com
    Target: 192.168.10.5 (Mail Server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)
    Port: 25
    ```

### 3.2 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Mail Relay Network

* ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Configuration > Mail Proxy > Networks**

  * ‡πÄ‡∏û‡∏¥‡πà‡∏° IP range ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡πà‡∏≤‡∏ô PMG ‡πÄ‡∏ä‡πà‡∏ô:

    ```
    192.168.10.0/24
    ```

---

## ‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•

1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤:

   * Email ‚Üí `user@example.com`
     ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤ PMG ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Log ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ Mail Server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≠‡∏Å:

   * Mail Server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ PMG ‡πÄ‡∏õ‡πá‡∏ô Smart Host ‡∏´‡∏£‡∏∑‡∏≠ SMTP Relay
   * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ mail ‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢

---

## ‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏£‡∏≠‡∏á‡∏™‡πÅ‡∏õ‡∏°/‡πÑ‡∏ß‡∏£‡∏±‡∏™

* ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Configuration > Mail Filter > Who Objects**

  * ‡∏™‡∏£‡πâ‡∏≤‡∏á object ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á/‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö

* ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Mail Filter Rules**

  * ‡∏™‡∏£‡πâ‡∏≤‡∏á Rule ‡πÄ‡∏ä‡πà‡∏ô:

    * IF: email ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
    * THEN: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Spam + Virus
    * ACTION: Block ‡∏´‡∏£‡∏∑‡∏≠ Quarantine

---

## ‚úÖ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô CLI

```bash
# ‡∏î‡∏π log ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•
tail -f /var/log/mail.log

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
systemctl status pmgproxy
systemctl status postfix

# Restart mail gateway service
systemctl restart pmg-smtp-filter
```

---

## üîê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SPF, DKIM, DMARC ‡πÉ‡∏ô DNS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
* ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Quarantine ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á
* ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ú‡πà‡∏≤‡∏ô `Backup` ‡πÉ‡∏ô Web UI ‡∏´‡∏£‡∏∑‡∏≠ `pmgbackup` CLI

---

‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå configuration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Proxmox Mail Gateway (PMG)** ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•, Mail Relay, ‡πÅ‡∏•‡∏∞‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•

---

## üìÅ 1. `/etc/pmg/pmg.conf` ‚Äì ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PMG ‡∏´‡∏•‡∏±‡∏Å

```ini
hostname example-pmg.example.com
email admin@example.com
timezone Asia/Bangkok
```

---

## üìÅ 2. `/etc/postfix/main.cf` ‚Äì ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Postfix (Mail Proxy)

PMG ‡πÉ‡∏ä‡πâ Postfix ‡πÄ‡∏õ‡πá‡∏ô SMTP engine ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á

```ini
myhostname = example-pmg.example.com
mydomain = example.com
myorigin = $mydomain
inet_interfaces = all
inet_protocols = all

relay_domains = proxy:mysql:/etc/postfix/mysql-relay-domains.cf
transport_maps = proxy:mysql:/etc/postfix/mysql-transport.cf

mydestination = localhost
mynetworks = 127.0.0.0/8, 192.168.10.0/24
smtpd_recipient_restrictions =
    permit_mynetworks,
    reject_unauth_destination

# Spam/Virus Headers
receive_override_options = no_address_mappings
content_filter = smtp:[127.0.0.1]:10024
```

---

## üìÅ 3. `/etc/postfix/mysql-relay-domains.cf` ‚Äì Relay Domains

```ini
user = pmg
password = your-db-password
hosts = 127.0.0.1
dbname = pmg
query = SELECT domain FROM relay_domains WHERE domain='%s'
```

PMG ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô Web UI ‚Üí **Mail Proxy > Relay Domains**

---

## üìÅ 4. `/etc/postfix/mysql-transport.cf` ‚Äì Mail Routing

```ini
user = pmg
password = your-db-password
hosts = 127.0.0.1
dbname = pmg
query = SELECT target FROM transport WHERE domain='%s'
```

‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞ forward email ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Mail Server ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏î

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å Web UI:

| Domain      | Target          |
| ----------- | --------------- |
| example.com | 192.168.10.5:25 |

---

## üìÅ 5. `/etc/pmg/pmg-smtp-filter.conf` ‚Äì ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ß‡∏£‡∏±‡∏™/‡∏™‡πÅ‡∏õ‡∏°

```ini
clamav = yes
spamassassin = yes
sa_rule_score_overwrite = no

quarantine = yes
quarantine_unsupported_types = yes
quarantine_attachments = yes
```

---

## üìÅ 6. `/etc/pmg/pmg-template.conf` (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)

‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï Quarantine Report / Footer / Reject Message ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô

---

## ‚úÖ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Policy ‡∏ú‡πà‡∏≤‡∏ô Web UI (Mail Filter)

### Rule: Block Executable Attachments

```plaintext
IF: attachment filetype is .exe OR .bat
THEN: Action = Block
```

‡∏´‡∏£‡∏∑‡∏≠

### Rule: Quarantine Spam

```plaintext
IF: Spam Score ‚â• 5.0
THEN: Quarantine + Add header
```

---

## üîß ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á CLI ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Debug/‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á
journalctl -u pmg-smtp-filter -f

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö log postfix
tail -f /var/log/mail.log

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏• (‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤)
telnet <PMG_IP> 25
```


